/**
 @Name：layuiAdmin 视图模块
 @Author：贤心
 @Site：http://www.layui.com/admin/
 @License：LPPL
 */
layui.define(["laytpl","layer"],function(e){var f=layui.jquery,h=layui.laytpl,g=layui.layer,c=layui.setter,b=layui.device(),d=layui.hint(),j=function(l){return new a(l)},i="layui-show",k="LAY_app_body",a=function(l){this.id=l;this.container=f("#"+(l||k))};j.load=function(l){this.cmsload=g.msg(l,{icon:16,shade:0.2,time:0})};j.loaded=function(){g.close(this.cmsload)};j.loading=function(l){j.removeLoad(l);l.append('<i class="view_loading"> </i><i class="layui-icon layui-icon-loading layui-icon layui-anim layui-anim-rotate layui-anim-loop view_loading"></i>')};j.removeLoad=function(l){l.find("i.view_loading").remove()};j.req=function(t){var p=this,r=t.success,q=t.error,o=c.request,n=c.response,m=t.ifdebug,l=function(){return c.debug?"<br><cite>URL：</cite>"+t.url:""};t.data=t.data||{};t.headers=t.headers||{};if(typeof window.csrf!="undefined"){var s=typeof t.data==="string"?JSON.parse(t.data):t.data;t.data["csrf"]=window.csrf}if(typeof m=="undefined"){m=1}if(o.tokenName){var s=typeof t.data==="string"?JSON.parse(t.data):t.data;t.data[o.tokenName]=o.tokenName in s?t.data[o.tokenName]:(layui.data(c.tableName)[o.tokenName]||"");t.headers[o.tokenName]=o.tokenName in t.headers?t.headers[o.tokenName]:(layui.data(c.tableName)[o.tokenName]||"")}delete t.success;delete t.error;return f.ajax(f.extend({type:"get",dataType:"json",success:function(w){var x=n.statusCode;layui.admin.loaded();if(typeof w[n.statusName]=="undefined"){w[n.statusName]=x.ok}if(typeof w[n.errorName]=="undefined"){w[n.errorName]=0}if(w[n.errorName]>0){if(typeof w[n.msgName]=="undefined"){w[n.msgName]="Error"}j.error(w[n.msgName])}if(w[n.statusName]==x.ok){typeof t.done==="function"&&t.done(w)}else{if(w[n.statusName]==x.logout){var v=["<cite>Error：</cite> "+(w[n.msgName]||"您已退出系统,请重新登入后再试"),l()].join("");j.error(v)}else{if(w[n.statusName]==x.csrf){var v=["<cite>Error：</cite> "+(w[n.msgName]||"非法提交"),l()].join("");j.error(v)}else{var u=["<cite>Error：</cite> "+(w[n.msgName]||"返回状态码异常"),l()].join("");j.error(u)}}}typeof r==="function"&&r(w)},error:function(w,v){layui.admin.loaded();if(m){var u=["请求异常，请重试<br><cite>错误信息：</cite>"+v,l()].join("");j.error(u)}typeof q==="function"&&q()}},t))};j.popup=function(l){var n=l.success,m=l.skin;delete l.success;delete l.skin;return g.open(f.extend({type:1,title:"提示",content:"",id:"LAY-system-view-popup",skin:"layui-layer-admin"+(m?" "+m:""),shadeClose:true,closeBtn:false,success:function(o,p){var q=f('<i class="layui-icon" close>&#x1006;</i>');o.append(q);q.on("click",function(){g.close(p)});typeof n==="function"&&n.apply(this,arguments)}},l))};j.error=function(m,l){return j.popup(f.extend({content:m,maxWidth:300,area:"300px",offset:"66px",id:"LAY_adminError"},l))};a.prototype.render=function(l,o){var n=this,m=layui.router();l=c.views+l+c.engine;f("#"+k).children(".layadmin-loading").remove();j.loading(n.container);f.ajax({url:l,type:"get",dataType:"html",data:{v:layui.cache.version},success:function(q){q="<div>"+q+"</div>";var r=f(q).find("title"),s=r.text()||(q.match(/\<title\>([\s\S]*)\<\/title>/)||[])[1];var p={title:s,body:q};r.remove();n.params=o||{};if(n.then){n.then(p);delete n.then}n.parse(q);j.removeLoad();if(n.done){n.done(p);delete n.done}},error:function(p){j.removeLoad();if(n.render.isError){return j.error("请求视图文件异常，状态："+p.status)}if(p.status===404){n.render("template/tips/404")}else{n.render("template/tips/error")}n.render.isError=true}});return n};a.prototype.parse=function(o,r,u){var q=this,p=typeof o==="object",m=p?o:f(o),l=p?o:m.find("*[template]"),s=function(w){var v=h(w.dataElem.html()),x=f.extend({params:t.params},w.res);w.dataElem.after(v.render(x));typeof u==="function"&&u();try{w.done&&new Function("d",w.done)(x)}catch(y){console.error(w.dataElem[0],"\n存在错误回调脚本\n\n",y)}},t=layui.router();m.find("title").remove();q.container[r?"after":"html"](m.children());t.params=q.params||{};for(var n=l.length;n>0;n--){(function(){var w=l.eq(n-1),A=w.attr("lay-done")||w.attr("lay-then"),v=h(w.attr("lay-url")||"").render(t),x=h(w.attr("lay-data")||"").render(t),z=h(w.attr("lay-headers")||"").render(t);try{x=new Function("return "+x+";")()}catch(y){d.error("lay-data: "+y.message);x={}}try{z=new Function("return "+z+";")()}catch(y){d.error("lay-headers: "+y.message);z=z||{}}if(v){j.req({type:w.attr("lay-type")||"get",url:v,data:x,dataType:"json",headers:z,success:function(B){s({dataElem:w,res:B,done:A})}})}else{s({dataElem:w,done:A})}}())}return q};a.prototype.autoRender=function(n,m){var l=this;f(n||"body").find("*[template]").each(function(o,p){var q=f(this);l.container=q;l.parse(q,"refresh")})};a.prototype.send=function(l,n){var m=h(l||this.container.html()).render(n||{});this.container.html(m);return this};a.prototype.refresh=function(o){var n=this,m=n.container.next(),l=m.attr("lay-templateid");if(n.id!=l){return n}n.parse(n.container,"refresh",function(){n.container.siblings('[lay-templateid="'+n.id+'"]:last').remove();typeof o==="function"&&o()});return n};a.prototype.then=function(l){this.then=l;return this
};a.prototype.done=function(l){this.done=l;return this};e("view",j)});