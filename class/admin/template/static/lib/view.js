layui.define(["laytpl","layer"],function(e){var f=layui.jquery,h=layui.laytpl,g=layui.layer,c=layui.setter,b=layui.device(),d=layui.hint(),k=function(m){return new a(m)},j="layui-show",l="LAY_app_body",a=function(m){this.id=m;this.container=f("#"+(m||l))};k.load=function(m){this.cmsload=g.msg(m,{icon:16,shade:0.2,time:0})};k.loaded=function(){g.close(this.cmsload)};k.loading=function(m){k.removeLoad(m);m.append('<i class="view_loading"> </i><i class="layui-icon layui-icon-loading layui-icon layui-anim layui-anim-rotate layui-anim-loop view_loading"></i>')};k.removeLoad=function(m){m.find("i.view_loading").remove()};k.req=function(u){var q=this,s=u.success,r=u.error,p=c.request,o=c.response,n=u.ifdebug,m=function(){return c.debug?"<br><cite>URL：</cite>"+u.url:""};u.data=u.data||{};u.headers=u.headers||{};if(typeof window.csrf!="undefined"){var t=typeof u.data==="string"?JSON.parse(u.data):u.data;u.data.csrf=window.csrf}if(typeof n=="undefined"){n=1}if(typeof u.dataType=="undefined"){u.dataType="json"}if(u.tips){layui.admin.load(u.tips)}if(p.tokenName){var t=typeof u.data==="string"?JSON.parse(u.data):u.data;u.data[p.tokenName]=p.tokenName in t?u.data[p.tokenName]:(layui.data(c.tableName)[p.tokenName]||"");u.headers[p.tokenName]=p.tokenName in u.headers?u.headers[p.tokenName]:(layui.data(c.tableName)[p.tokenName]||"")}delete u.success;delete u.error;return f.ajax(f.extend({type:"get",dataType:"json",success:function(x){var y=o.statusCode;layui.admin.loaded();if(u.dataType!="json"){typeof u.done==="function"&&u.done(x);typeof s==="function"&&s(x);return}if(typeof x[o.statusName]=="undefined"){x[o.statusName]=y.ok}if(typeof x[o.errorName]=="undefined"){x[o.errorName]=0}if(x[o.errorName]>0){if(typeof x[o.msgName]=="undefined"){x[o.msgName]="Error"}k.error(x[o.msgName]);return}if(x[o.statusName]==y.ok){if(u.popup&&!x.popup){if(x.msg){layui.layer.msg(x.msg)}}else{if(u.popup){confirmargs=[];if(x.msg){confirmargs[0]=x.msg}else{confirmargs[0]=""}confirmargs[1]={btn:[],shadeClose:1};if(x.popup.title){confirmargs[1]["title"]=x.popup.title}if(x.popup.time){confirmargs[1]["time"]=x.popup.time}if(x.popup.icon){confirmargs[1]["icon"]=x.popup.icon}if(x.popup.anim){confirmargs[1]["anim"]=x.popup.anim}if(x.popup.end){if(x.popup.end==="back"){x.popup.end="layui.admin.events.back();"}if(x.popup.end==="reload"){x.popup.end="layui.admin.events.reload();"}confirmargs[1]["end"]=new Function("index","layero",x.popup.end)}if(x.popup.success){confirmargs[1]["success"]=new Function("index","layero",x.popup.success)}i=0;for(let key in x.popup.btns){confirmargs[1]["btn"][i]=key;js="";if(typeof(x.popup.btns[key])=="string"){if(x.popup.btns[key]==="ok"||x.popup.btns[key]==="close"){js="layui.layer.close(index);"}else{if(x.popup.btns[key]==="reload"){js="layui.admin.events.reload();"}else{if(x.popup.btns[key]==="back"){js="layui.admin.events.back();"}else{js=x.popup.btns[key]}}}}else{if(x.popup.btns[key]["go"]){js="window.location='"+x.popup.btns[key]["go"]+"';"}else{if(x.popup.btns[key]["open"]){js="window.open('"+x.popup.btns[key]["open"]+"');"}}}confirmargs[1]["btn"+(i+1)]=new Function("index","layero",js);i++}g.confirm.apply(null,confirmargs)}}typeof u.done==="function"&&u.done(x)}else{if(x[o.statusName]==y.logout){var w=["<cite>Error：</cite> "+(x[o.msgName]||"您已退出系统,请重新登入后再试"),m()].join("");k.error(w)}else{if(x[o.statusName]==y.csrf){var w=["<cite>Error：</cite> "+(x[o.msgName]||"非法提交"),m()].join("");k.error(w)}else{var v=["<cite>Error：</cite> "+(x[o.msgName]||"返回状态码异常"),m()].join("");k.error(v)}}}typeof s==="function"&&s(x)},error:function(x,w){layui.admin.loaded();if(n){var v=["请求异常，请重试<br>"+x.responseText,m()].join("");k.error(v)}typeof r==="function"&&r()}},u))};k.popup=function(m){var o=m.success,n=m.skin;delete m.success;delete m.skin;return g.open(f.extend({type:1,title:"提示",content:"",id:"LAY-system-view-popup",skin:"layui-layer-admin"+(n?" "+n:""),shadeClose:true,closeBtn:false,success:function(p,q){var r=f('<i class="layui-icon" close>&#x1006;</i>');p.append(r);r.on("click",function(){g.close(q)});typeof o==="function"&&o.apply(this,arguments)}},m))};k.error=function(n,m){return k.popup(f.extend({content:n,maxWidth:300,area:"300px",offset:"66px",id:"LAY_adminError"},m))};a.prototype.render=function(m,p){var o=this,n=layui.router();m=c.views+m+c.engine;f("#"+l).children(".layadmin-loading").remove();k.loading(o.container);f.ajax({url:m,type:"get",dataType:"html",data:{v:layui.cache.version},success:function(r){r="<div>"+r+"</div>";var s=f(r).find("title"),t=s.text()||(r.match(/\<title\>([\s\S]*)\<\/title>/)||[])[1];var q={title:t,body:r};s.remove();o.params=p||{};if(o.then){o.then(q);delete o.then}o.parse(r);k.removeLoad();if(o.done){o.done(q);delete o.done}},error:function(q){k.removeLoad();if(o.render.isError){return k.error("请求视图文件异常，状态："+q.status)}if(q.status===404){o.render("template/tips/404")}else{o.render("template/tips/error")}o.render.isError=true}});return o};a.prototype.parse=function(p,s,v){var r=this,q=typeof p==="object",n=q?p:f(p),m=q?p:n.find("*[template]"),t=function(x){var w=h(x.dataElem.html()),y=f.extend({params:u.params},x.res);x.dataElem.after(w.render(y));typeof v==="function"&&v();try{x.done&&new Function("d",x.done)(y)}catch(z){console.error(x.dataElem[0],"\n存在错误回调脚本\n\n",z)}},u=layui.router();n.find("title").remove();r.container[s?"after":"html"](n.children());u.params=r.params||{};for(var o=m.length;o>0;o--){(function(){var x=m.eq(o-1),B=x.attr("lay-done")||x.attr("lay-then"),w=h(x.attr("lay-url")||"").render(u),y=h(x.attr("lay-data")||"").render(u),A=h(x.attr("lay-headers")||"").render(u);try{y=new Function("return "+y+";")()}catch(z){d.error("lay-data: "+z.message);y={}}try{A=new Function("return "+A+";")()}catch(z){d.error("lay-headers: "+z.message);A=A||{}}if(w){k.req({type:x.attr("lay-type")||"get",url:w,data:y,dataType:"json",headers:A,success:function(C){t({dataElem:x,res:C,done:B})}})}else{t({dataElem:x,done:B})}}())}return r};a.prototype.autoRender=function(o,n){var m=this;f(o||"body").find("*[template]").each(function(p,q){var r=f(this);m.container=r;m.parse(r,"refresh")})};a.prototype.send=function(m,o){var n=h(m||this.container.html()).render(o||{});this.container.html(n);return this};a.prototype.refresh=function(p){var o=this,n=o.container.next(),m=n.attr("lay-templateid");if(o.id!=m){return o}o.parse(o.container,"refresh",function(){o.container.siblings('[lay-templateid="'+o.id+'"]:last').remove();typeof p==="function"&&p()});return o};a.prototype.then=function(m){this.then=m;return this};a.prototype.done=function(m){this.done=m;return this};e("view",k)});
