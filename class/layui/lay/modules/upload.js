layui.define("layer",function(a){"use strict";var b=layui.$,c=layui.layer,d=layui.hint(),e=layui.device(),f={config:{},set:function(a){var c=this;return c.config=b.extend({},c.config,a),c},on:function(a,b){return layui.onevent.call(this,h,a,b)}},g=function(){var a=this;return{upload:function(b){a.upload.call(a,b)},reload:function(b){a.reload.call(a,b)},config:a.config}},h="upload",n="layui-upload-file",o="layui-upload-form",p="layui-upload-iframe",q="layui-upload-choose",s=function(a){var c=this;c.config=b.extend({},c.config,f.config,a),c.render()};s.prototype.config={accept:"images",exts:"",auto:!0,bindAction:"",url:"",force:"",field:"file",acceptMime:"",method:"post",data:{},drag:!0,size:0,number:0,multiple:!1},s.prototype.render=function(a){var c=this,a=c.config;a.elem=b(a.elem),a.bindAction=b(a.bindAction),c.file(),c.events()},s.prototype.file=function(){var a=this,c=a.config,d=a.elemFile=b(['<input class="'+n+'" type="file" accept="'+c.acceptMime+'" name="'+c.field+'"',c.multiple?" multiple":"",">"].join("")),f=c.elem.next();(f.hasClass(n)||f.hasClass(o))&&f.remove(),e.ie&&e.ie<10&&c.elem.wrap('<div class="layui-upload-wrap"></div>'),a.isFile()?(a.elemFile=c.elem,c.field=c.elem[0].name):c.elem.after(d),e.ie&&e.ie<10&&a.initIE()},s.prototype.initIE=function(){var a=this,c=a.config,d=b('<iframe id="'+p+'" class="'+p+'" name="'+p+'" frameborder="0"></iframe>'),e=b(['<form target="'+p+'" class="'+o+'" method="post" key="set-mine" enctype="multipart/form-data" action="'+c.url+'">',"</form>"].join(""));b("#"+p)[0]||b("body").append(d),c.elem.next().hasClass(o)||(a.elemFile.wrap(e),c.elem.next("."+o).append(function(){var a=[];return layui.each(c.data,function(b,c){c="function"==typeof c?c():c,a.push('<input type="hidden" name="'+b+'" value="'+c+'">')}),a.join("")}()))},s.prototype.msg=function(a){return c.msg(a,{icon:2,shift:6})},s.prototype.isFile=function(){var a=this.config.elem[0];if(a)return"input"===a.tagName.toLocaleLowerCase()&&"file"===a.type},s.prototype.preview=function(a){var b=this;window.FileReader&&layui.each(b.chooseFiles,function(b,c){var d=new FileReader;d.readAsDataURL(c),d.onload=function(){a&&a(b,c,this.result)}})},s.prototype.upload=function(a,c){var m,u,d=this,f=d.config,g=d.elemFile[0],h=function(){var c=0,e=0,h=a||d.files||d.chooseFiles||g.files,i=function(){f.multiple&&c+e===d.fileLength&&"function"==typeof f.allDone&&f.allDone({total:d.fileLength,successful:c,failed:e})};layui.each(h,function(a,g){var l,h=new FormData;h.append(f.field,g),layui.each(f.data,function(a,b){b="function"==typeof b?b():b,h.append(a,b)}),l={url:f.url,type:"post",data:h,contentType:!1,processData:!1,dataType:"json",headers:f.headers||{},success:function(b){c++,j(a,b),i()},error:function(b){e++,d.msg("Request URL is abnormal: "+(b.statusText||"error")),k(a),i()}},"function"==typeof f.progress&&(l.xhr=function(){var c=b.ajaxSettings.xhr();return c.upload.addEventListener("progress",function(b){if(b.lengthComputable){var c=Math.floor(100*(b.loaded/b.total));f.progress(c,f.item?f.item[0]:f.elem[0],b,a)}}),c}),b.ajax(l)})},i=function(){var a=b("#"+p);d.elemFile.parent().submit(),clearInterval(s.timer),s.timer=setInterval(function(){var b,c=a.contents().find("body");try{b=c.text()}catch(e){d.msg("Cross-domain requests are not supported"),clearInterval(s.timer),k()}b&&(clearInterval(s.timer),c.html(""),j(0,b))},30)},j=function(a,b){if(d.elemFile.next("."+q).remove(),g.value="","json"===f.force&&"object"!=typeof b)try{b=JSON.parse(b)}catch(c){return b={},d.msg("Please return JSON data format")}"function"==typeof f.done&&f.done(b,a||0,function(a){d.upload(a)})},k=function(a){f.auto&&(g.value=""),"function"==typeof f.error&&f.error(a||0,function(a){d.upload(a)})},l=f.exts,n=function(){var b=[];return layui.each(a||d.chooseFiles,function(a,c){b.push(c.name)}),b}(),o={preview:function(a){d.preview(a)},upload:function(a,b){var c={};c[a]=b,d.upload(c)},pushFile:function(){return d.files=d.files||{},layui.each(d.chooseFiles,function(a,b){d.files[a]=b}),d.files},resetFile:function(a,b,c){var e=new File([b],c);d.files=d.files||{},d.files[a]=e}},r=function(){return f.before&&f.before(o)===!1?void 0:e.ie?e.ie>9?h():i():(h(),void 0)},t={file:"文件",images:"图片",video:"视频",audio:"音频"}[f.accept]||"文件";if(n=0===n.length?g.value.match(/[^\/\\]+\..+/g)||[]||"":n,0!==n.length){switch(f.accept){case"file":layui.each(n,function(a,b){return l&&!RegExp(".\\.("+l+")$","i").test(escape(b))?m=!0:void 0});break;case"video":layui.each(n,function(a,b){return RegExp(".\\.("+(l||"avi|mp4|wma|rmvb|rm|flash|3gp|flv")+")$","i").test(escape(b))?void 0:m=!0});break;case"audio":layui.each(n,function(a,b){return RegExp(".\\.("+(l||"mp3|wav|mid")+")$","i").test(escape(b))?void 0:m=!0});break;default:layui.each(n,function(a,b){return RegExp(".\\.("+(l||"jpg|png|gif|bmp|jpeg|webp|ico")+")$","i").test(escape(b))?void 0:m=!0})}if(m)return d.msg("选择的"+t+"中包含不支持的格式"),g.value="";if("choose"!==c&&!f.auto||(f.choose&&f.choose(o),"choose"!==c))return d.fileLength=function(){var b=0,c=a||d.files||d.chooseFiles||g.files;return layui.each(c,function(){b++}),b}(),f.number&&d.fileLength>f.number?d.msg("同时最多只能上传: "+f.number+" 个文件"+"<br>您当前已经选择了: "+d.fileLength+" 个文件"):f.size>0&&!(e.ie&&e.ie<10)&&(layui.each(d.chooseFiles,function(a,b){if(b.size>1024*f.size){var c=f.size/1024;c=c>=1?c.toFixed(2)+"MB":f.size+"KB",g.value="",u=c}}),u)?d.msg("文件大小不能超过 "+u):(r(),void 0)}},s.prototype.reload=function(a){a=a||{},delete a.elem,delete a.bindAction;var c=this,a=c.config=b.extend({},c.config,f.config,a),d=a.elem.next();d.attr({name:a.name,accept:a.acceptMime,multiple:a.multiple})},s.prototype.events=function(){var a=this,c=a.config,f=function(b){a.chooseFiles={},layui.each(b,function(b,c){var d=(new Date).getTime();a.chooseFiles[d+"-"+b]=c})},g=function(b){var e=a.elemFile,g=(c.item?c.item:c.elem,b.length>1?b.length+"个文件":(b[0]||{}).name||e[0].value.match(/[^\/\\]+\..+/g)||[]||"");e.next().hasClass(q)&&e.next().remove(),a.upload(null,"choose"),a.isFile()||c.choose||e.after('<span class="layui-inline '+q+'">'+g+"</span>")};c.elem.off("upload.start").on("upload.start",function(){var e=b(this),f=e.attr("lay-data");if(f)try{f=new Function("return "+f)(),a.config=b.extend({},c,f)}catch(g){d.error("Upload element property lay-data configuration item has a syntax error: "+f)}a.config.item=e,a.elemFile[0].click()}),e.ie&&e.ie<10||c.elem.off("upload.over").on("upload.over",function(){var a=b(this);a.attr("lay-over","")}).off("upload.leave").on("upload.leave",function(){var a=b(this);a.removeAttr("lay-over")}).off("upload.drop").on("upload.drop",function(d,e){var h=b(this),i=e.originalEvent.dataTransfer.files||[];h.removeAttr("lay-over"),f(i),c.auto?a.upload():g(i)}),a.elemFile.off("upload.change").on("upload.change",function(){var b=this.files||[];f(b),c.auto?a.upload():g(b)}),c.bindAction.off("upload.action").on("upload.action",function(){a.upload()}),c.elem.data("haveEvents")||(a.elemFile.on("change",function(){b(this).trigger("upload.change")}),c.elem.on("click",function(){a.isFile()||b(this).trigger("upload.start")}),c.drag&&c.elem.on("dragover",function(a){a.preventDefault(),b(this).trigger("upload.over")}).on("dragleave",function(){b(this).trigger("upload.leave")}).on("drop",function(a){a.preventDefault(),b(this).trigger("upload.drop",a)}),c.bindAction.on("click",function(){b(this).trigger("upload.action")}),c.elem.data("haveEvents",!0))},f.render=function(a){var b=new s(a);return g.call(b)},a(h,f)});